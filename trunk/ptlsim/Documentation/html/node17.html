<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2002-2-1 (1.70)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Forwarding, Wakeup and Writeback</TITLE>
<META NAME="description" CONTENT="Forwarding, Wakeup and Writeback">
<META NAME="keywords" CONTENT="PTLsimManual">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="Generator" CONTENT="LaTeX2HTML v2002-2-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="PTLsimManual.css">

<LINK REL="next" HREF="node18.html">
<LINK REL="previous" HREF="node16.html">
<LINK REL="up" HREF="node9.html">
<LINK REL="next" HREF="node18.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html589"
  HREF="node18.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html585"
  HREF="node9.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html579"
  HREF="node16.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html587"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html590"
  HREF="node18.html">Commitment</A>
<B> Up:</B> <A NAME="tex2html586"
  HREF="node9.html">Out of Order Processor</A>
<B> Previous:</B> <A NAME="tex2html580"
  HREF="node16.html">Stores</A>
 &nbsp; <B>  <A NAME="tex2html588"
  HREF="node1.html">Contents</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html591"
  HREF="node17.html#SECTION04810000000000000000">Forwarding and the Clustered Bypass Network</A>
<LI><A NAME="tex2html592"
  HREF="node17.html#SECTION04820000000000000000">Writeback</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION04800000000000000000">
Forwarding, Wakeup and Writeback</A>
</H1>

<P>

<H1><A NAME="SECTION04810000000000000000">
Forwarding and the Clustered Bypass Network</A>
</H1>

<P>
Immediately after each uop is issued and the <TT><FONT SIZE="-1">ReorderBufferEntry::issue()</FONT></TT>
method actually generates its result, the <TT><FONT SIZE="-1">cycles_left</FONT></TT>
field of the ROB is set to the expected latency of the uop (e.g. between
1 and 5 cycles). The uop is then moved to the <I>issued</I> state
and placed on the <TT><FONT SIZE="-1">rob_issued_list</FONT></TT>. Every cycle,
the <TT><FONT SIZE="-1">complete()</FONT></TT> method iterates through each ROB in
issued state and decrements its <TT><FONT SIZE="-1">cycles_left</FONT></TT> field.
If <TT><FONT SIZE="-1">cycles_left</FONT></TT> becomes zero, the corresponding uop
has completed execution. The ROB is moved to the <I>completed</I>
state (on <TT><FONT SIZE="-1">rob_completed_list</FONT></TT>) and its physical register
or store queue entry is moved to the <TT><FONT SIZE="-1">ready</FONT></TT> state so
newly dispatched uops do not try to wait for it.

<P>
The <TT><FONT SIZE="-1">transfer()</FONT></TT> function is also called every cycle.
This function examines the list of ROBs in the <I>completed</I> state
and is responsible for broadcasting the completed ROB's tag (ROB index)
to the issue queues. Because of clustering (Section <A HREF="node13.html#sec:Clustering">9.1</A>),
some issue queues will receive the broadcast later than others. Specifically,
the ROB's <TT><FONT SIZE="-1">forward_cycle</FONT></TT> field determines which issue
queues and remote clusters are visible <TT><FONT SIZE="-1">forward_cycle</FONT></TT>
cycles after the uop completed. The <TT><FONT SIZE="-1">forward()</FONT></TT> method,
called by <TT><FONT SIZE="-1">transfer()</FONT></TT> for each uop in the <I>completed</I>
state, indexes into a lookup table <TT><FONT SIZE="-1">forward_at_cycle_lut[</FONT></TT><I>cluster</I><TT><FONT SIZE="-1">][</FONT></TT><I>forward_cycle</I><TT><FONT SIZE="-1">]</FONT></TT>
to get a bitmap of which remote clusters are accessible <TT><FONT SIZE="-1">forward_cycle</FONT></TT>
cycles after he uop completed, relative to the original cluster.the
uop issued in. The <TT><FONT SIZE="-1">IssueQueue::broadcast()</FONT></TT> method
(Section <A HREF="node13.html#sec:Scheduling">9.3</A>) is then called for each applicable
cluster to wake up any operands of uops in that cluster waiting on
the newly completed uop.

<P>
The <TT><FONT SIZE="-1">MAX_FORWARDING_LATENCY</FONT></TT> constant (in ooohwdef.h)
specifies the maximum number of cycles between any two clusters. After
the ROB has progressed through <TT><FONT SIZE="-1">MAX_FORWARDING_LATENCY</FONT></TT>
cycles in the <I>completed</I> state, it is moved to the <TT><FONT SIZE="-1">ready-to-writeback</FONT></TT>
state, effectively meaning the result has arrived at the physical
register file and is eligible for writeback in the next cycle.

<P>

<H1><A NAME="SECTION04820000000000000000">
Writeback</A>
</H1>

<P>
Every cycle, the <TT><FONT SIZE="-1">writeback()</FONT></TT> function scans the list
of ROBs in the <I>ready-to-writeback</I> state and selects at most
<TT><FONT SIZE="-1">WRITEBACK_WIDTH</FONT></TT> results to write to the physical
register file. The <TT><FONT SIZE="-1">forward()</FONT></TT> method is first called
one final time to catch the corner case in which a dependent uop was
dispatched while producer uop was waiting in the <I>ready-to-writeback</I>
state.

<P>
As mentioned in Section <A HREF="node13.html#sec:Issue">9.4</A>, for simulation purposes
only, each uop puts its result directly into its assigned physical
register at the time of issue, even though the data technically does
not appear there until writeback. This is done to simplify the simulator
implementation; it is assumed that any data ``read'' from physical
registers before writeback is in fact being read from the bypass network
instead. Therefore, no actual data movement occurs in the <TT><FONT SIZE="-1">writeback()</FONT></TT>
function; its sole purpose is to place the uop's physical register
into the written state (via the <TT><FONT SIZE="-1">PhysicalRegister::writeback()</FONT></TT>
method) and to move the ROB into its terminal state, <I>ready-to-commit</I>.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html589"
  HREF="node18.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html585"
  HREF="node9.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html579"
  HREF="node16.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html587"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html590"
  HREF="node18.html">Commitment</A>
<B> Up:</B> <A NAME="tex2html586"
  HREF="node9.html">Out of Order Processor</A>
<B> Previous:</B> <A NAME="tex2html580"
  HREF="node16.html">Stores</A>
 &nbsp; <B>  <A NAME="tex2html588"
  HREF="node1.html">Contents</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
Matt T Yourst
2005-10-26
</ADDRESS>
</BODY>
</HTML>
